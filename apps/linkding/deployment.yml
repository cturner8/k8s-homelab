---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: linkding
spec:
  replicas: 1
  selector:
    matchLabels:
      app: linkding
  template:
    metadata:
      labels:
        app: linkding
    spec:
      containers:
        - name: linkding
          image: "ghcr.io/sissbruecker/linkding:1.44.1"
          env:
            - name: LD_CSRF_TRUSTED_ORIGINS
              value: "https://linkding.kube.local.gd:8443"
            - name: LD_ENABLE_OIDC
              value: "1"
            - name: OIDC_USE_PKCE
              value: "1"
            - name: OIDC_OP_AUTHORIZATION_ENDPOINT
              value: "https://pocketid.kube.local.gd:8443/authorize"
            - name: OIDC_OP_TOKEN_ENDPOINT
              value: "http://pocketid.pocketid.svc.cluster.local:1411/api/oidc/token"
            - name: OIDC_OP_USER_ENDPOINT
              value: "http://pocketid.pocketid.svc.cluster.local:1411/api/oidc/userinfo"
            - name: OIDC_OP_JWKS_ENDPOINT
              value: "http://pocketid.pocketid.svc.cluster.local:1411/.well-known/jwks.json"
            - name: OIDC_RP_CLIENT_ID
              value: "e3a39a6d-34b7-48f2-8efa-f21c495a87ee"
          ports:
            - containerPort: 9090
          livenessProbe:
            tcpSocket:
              port: 9090
            initialDelaySeconds: 10
          readinessProbe:
            tcpSocket:
              port: 9090
            initialDelaySeconds: 10
          resources:
            limits:
              cpu: "500m"
              memory: "512Mi"
            requests:
              cpu: "125m"
              memory: "128Mi"
          volumeMounts:
            - mountPath: /etc/linkding/data
              name: linkding-data
      volumes:
        - name: linkding-data
          persistentVolumeClaim:
            claimName: linkding-data
